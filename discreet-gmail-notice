// ==UserScript==
// @name         Discreet Gmail Admin Notice
// @namespace    http://tampermonkey.net/
// @version      1.1
// @description  Replaces red Workspace warnings with a subtle grey notice (Trusted Types Compliant)
// @author       Gemini
// @match        https://mail.google.com/*
// @grant        none
// ==/UserScript==

(function() {
    'use strict';

    // 1. Add the CSS to the head safely
    const style = document.createElement('style');
    style.textContent = `
        .discreet-admin-notice {
            background-color: #f1f3f4 !important;
            color: #70757a !important;
            padding: 8px 16px;
            font-size: 12px;
            text-align: center;
            border-bottom: 1px solid #dadce0;
            font-family: 'Roboto', sans-serif;
            position: relative;
            z-index: 999;
        }
        .discreet-admin-notice a {
            color: #1a73e8 !important;
            text-decoration: underline;
            margin-left: 10px;
            font-weight: 500;
        }
        /* Hide the original aggressive banner */
        .bir, .bip, div[id=":7"] {
            display: none !important;
            height: 0 !important;
            overflow: hidden !important;
        }
    `;
    document.head.appendChild(style);

    function disguiseWarning() {
        // Look for the banner by class
        const warnings = document.querySelectorAll('.bir');

        warnings.forEach(warning => {
            // Only act if we haven't already replaced it
            if (warning.innerText.includes("unable to renew") && !document.querySelector('.discreet-admin-notice')) {

                // Get the original link safely
                const originalLink = warning.querySelector('a')?.href || "https://admin.google.com/";

                // Build the notice using DOM methods (Trusted Types compliant)
                const newNotice = document.createElement('div');
                newNotice.className = 'discreet-admin-notice';

                const textNode = document.createTextNode('Admin notice from Google: Subscription status update required. ');
                const linkNode = document.createElement('a');
                linkNode.href = originalLink;
                linkNode.target = '_blank';
                linkNode.textContent = 'Review';

                newNotice.appendChild(textNode);
                newNotice.appendChild(linkNode);

                // Insert at the very top of the Gmail interface
                const canvas = document.querySelector('.aiw') || document.body;
                canvas.prepend(newNotice);
            }
        });
    }

    // Run frequently to catch the dynamic load
    setInterval(disguiseWarning, 2000);
})();
